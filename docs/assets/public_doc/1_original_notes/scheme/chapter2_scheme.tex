\chapter{SCHEME}

\section{DEFINITION OF SCHEME AND MORPHISM OF SCHEMES}

\begin{definition}[scheme, morphism of schemes]
	A scheme is a locally ringed space $(X, \ms{O})$ such that for every point $x \in X$, there is an open neighbourhood $U_x$ containing $x$ so that $(U_x, \ms{O}\vert_{U_x})$ is an affine scheme. Morphism of schemes is morphism of locally ringed spaces.
\end{definition}

We obtain the category of schemes, denoted by $\Sch$

\begin{definition}[scheme over $S$]
	Let $S$ be a scheme, the category $(\Sch / S)$ of schemes over $S$ is the category where an object is a morphism of schemes $X \to S$ and a morphism is a morphism of schemes $X \to Y$ so that $X \to S$ factors through $Y$ by the map $X \to Y$
	\begin{center}
		\begin{tikzcd}
			X \arrow[rr] \arrow[rd] &   & Y \arrow[ld] \\
			& S &             
		\end{tikzcd}
	\end{center}
	
	The collection of morphisms from $X \to S$ into $Y \to S$ is denoted by $\Hom_S(X, Y)$. If $S = \Spec A$, we also call scheme over $S$ as scheme over $A$
\end{definition}

Since $\Spec \Z$ is a terminal object in the category of schemes, the category of schemes is canonically equivalent the category of schemes over $\Z$ \note{(proof for $\Spec \Z$ is terminal in next section)}

\section{GLUING OF MORPHISMS}

\begin{definition}[open subscheme]
	Let $(X, \ms{O}_X)$ be a scheme and $U \subseteq X$ be an open subset. Then, the locally ringed space $(U, \ms{O}_{X}\vert_U)$ is a scheme and we call it an open subscheme of $X$. If the 
\end{definition}

\begin{lemma}
	Let $X$ be a scheme and $U, V$ be open affine subschemes of $X$. Then for every $x \in U \cap V$, there exists an open subscheme $W \subseteq U \cap V$ containing $x$ such that $W$ is principal open in $U$ as well as in $V$.
\end{lemma}

\begin{proposition}[gluing of morphisms]
	Let $X, Y$ be locally ringed spaces. Then $U \mapsto \Hom(U, Y)$ sending open subset $U \subseteq X$ into the set of morphisms $(U, \ms{O}_X\vert_U) \to (Y, \ms{O}_Y)$ is a sheaf of sets on $X$.
\end{proposition}

In other words, if $X = \bigcup_i U_i$ is an open covering, then a family of morphisms $U_i \to Y$ glues into a morphism $X \to Y$ if and only if the morphisms coincide on intersections $U_i \cap U_j$. Moreover, in that case, the resulting morphism $X \to Y$ is uniquely determined.

\note{TODO - proof idea - one can identify the morphism by map between stalks, it feels local hence gluable}

\begin{proposition}
	Let $X$ be a locally ringed space and $Y = \Spec A$ an affine scheme. Then, the natural map
	\begin{align*}
		\Hom(X, Y) &\to \Hom(A, \Gamma(X)) \\
		(f, f^\flat) &\mapsto f^\flat_Y
	\end{align*}
	is a bijection.
\end{proposition}

\begin{proof}
	\note{(TODO - use lemma above to prove for the case X is a scheme, full proof in EGAInew 1.6.3)}
\end{proof}

$\Spec \Z$ being terminal object in the category of schemes follows this proposition. Moreover, when $A = \Gamma(X)$, there corresponds to $\id_{\Gamma(X)}$ a morphism
$$
	c_X: X \to \Spec \Gamma(X)
$$

which we call canonical.

\section{SOME BASIC MORPHISMS}

\subsection{MORPHISM FROM AFFINE POINT}

Let $X$ be a scheme. Let $x \in X$ and $U \subseteq X$ be an open affine subscheme of $x$, let $U = \Spec A$. Let $\mf{p} \in \Spec A$ corresponds to $x$. Then, the natural map $A \to A_\mf{p}$ induces a morphism
$$
	j_x: \Spec \ms{O}_{X, x} = \Spec A_\mf{p} \to \Spec A = U \subseteq X
$$

(\note{here, stalk at $x \in X$ is the same as stalk at $x \in X$ because stalk is defined as colimit, so it doesn't matter if we restrict to $U$ or not - Görtz - Wedhorn didn't explain it clearly, so below is my attempt \footnote{math.SE \url{https://math.stackexchange.com/q/5116709/700122}}})

\begin{proof}[proof for $j_x: \Spec \ms{O}_{X, x} \to X$ being independent of choice of $U$]
	Let $U$ and $V$ be two open affine subschemes containing $x$, let $U = \Spec A$ and $V = \Spec B$, let $\mf{p} \in \Spec A$ and $\mf{q} \in \Spec B$ correspond to $x$. Then $A_\mf{p} = B_\mf{q}$ and we have two maps $j^U_{x}: \Spec \ms{O}_{X, x} \to U$ and $j^V_{x}: \Spec \ms{O}_{X, x} \to V$. By definition, $\ms{O}_{X, x}$ is the colimit of functor $\ms{O}_X$ from the category of open sets containing $x$. Since the contravariant functor $\Spec$ is fully faithful, it preserves limits, $\Spec \ms{O}_{X, x}$ is the limit of the functor $\Spec \ms{O}_X$. By universal property of limit, let $W = U \cap V$, then $j^U_x$ and $j^V_x$ factor through a unique map $\Spec \ms{O}_{X, x} \to W$ into their intersection and inclusions of schemes $W \hookrightarrow U$ and $W \hookrightarrow V$
	\begin{center}
		\begin{tikzcd}
			& \ms{O}_{X}(U) \arrow[d] \arrow[ld] &                                                               & U                                 \\
			{\ms{O}_{X, x}} & \ms{O}_{X}(W) \arrow[l, dashed]    & {\Spec \ms{O}_{X, x}} \arrow[ru] \arrow[rd] \arrow[r, dashed] & W \arrow[u, hook] \arrow[d, hook] \\
			& \ms{O}_{X}(V) \arrow[u] \arrow[lu] &                                                               & V                                
		\end{tikzcd}
	\end{center}
\end{proof}

Image of $j_x$ in $X$ is the intersection of all open subsets containing $x$ \note{(consider the map $A \to A_\mf{p}$, its kernel is $\mf{a} = \set{a \in A: as = 0 \text{ for some } s \notin \mf{p}}$. Hence, the image of $j_x$ are those primes in $A$ containing $\mf{a}$, ...)}

Let $\kappa(x) = \ms{O}_{X,x} / \mf{m}_x$ be the residue field at $x$, we obtain the map of schemes
$$
	i_x: \Spec \kappa(x) \to \Spec \ms{O}_{X,x} \to X
$$

which is called canonical. The image point of $i_x$ in $X$ is $x$.

Now let $k$ be a field and $f: \Spec k \to X$ be a map, let $x$ be the image point on $X$ of the singleton $p \in \Spec k$. The map $f$ induces a map on stalks $f^\#_p: \ms{O}_{X, x} \to \ms{O}_{\Spec k, p} = k$. Since $\ms{O}_{X, x}$ is local, $\ms{O}_{X, x} \to k$ factors through $\ms{O}_{X, x} \to \kappa(x)$. Hence, $\Spec k \to \Spec \ms{O}_{X, x}$ factors through $\Spec \kappa(x) \to \Spec \ms{O}_{X, x}$.
\begin{center}
	\begin{tikzcd}
		\kappa(x) \arrow[d, dashed] & {\ms{O}_{X, x}} \arrow[ld, "f^\#_p"] \arrow[l] & \Spec \kappa(x) \arrow[r] \arrow[rr, "i_x", bend left] & {\Spec \ms{O}_{X, x}} \arrow[r] & X \\
		k                           &                                                & \Spec k \arrow[ru] \arrow[u, dashed] \arrow[rru, "f"'] &                                 &  
	\end{tikzcd}
\end{center}

Moreover, $f: \Spec k \to X$ factors through $i_x: \kappa(x) \to X$ \note{(this is very nice but GW didn't explain clearly why $i_x$ has such a nice property - I guess what's outside a proof is informal)}

\begin{proposition}
	There is a bijection of sets
	$$
		\Hom(\Spec k, X) \to X \times \Hom(\kappa(x), k)
	$$
\end{proposition}

\subsection{MORPHISM INTO AFFINE POINT}

\note{(from Borcherds lecture on gluing schemes)}

Let $k$ be a field and $R$ be a ring, the map $\Spec R \to \Spec k$ that factors through $\Spec k[x]$ corresponds to an element of $R$, that is, a regular function on the global section of $\Spec R$

\begin{center}
	\begin{tikzcd}
		R                             &                         & {k[x]} \arrow[ll]       &                         &         &                         \\
		& k \arrow[lu] \arrow[ru] &                         &                         &         &                         \\
		\Spec R \arrow[rr] \arrow[rd] &                         & {\Spec k[x]} \arrow[ld] & X \arrow[rr] \arrow[rd] &         & {\Spec k[x]} \arrow[ld] \\
		& \Spec k                 &                         &                         & \Spec k &                        
	\end{tikzcd}
\end{center}

Similar, any map from scheme $X$ into $\Spec k$ that factors through $\Spec k[x]$ is a regular function on global section of $X$ since $X$ can be covered by open affine subschemes.

\section{GLUING SCHEMES, DISJOINT UNION OF SCHEMES}

\begin{definition}[gluing of schemes]
	A gluing of schemes consists of the following data: given an index set $I$
	\begin{itemize}
		\item for all $i \in I$, a scheme $U_i$
		\item for all $i,j  \in I$, an open subscheme $U_{ij} \subseteq U_i$ such that $U_{ii} = U_i$ for all $i \in I$
		\item for all $i, j \in I$, an isomorphism $\phi_{ji}: U_{ij} \to U_{ji}$ of schemes such that the cocycle condition holds
		$$
			\phi_{kj} \phi_{ji} = \phi_{ki}
		$$
		
		on $U_{ij} \cap U_{ik}$ for all $i, j, k \in I$ if $\phi_{ji}(U_{ij} \cap U_{ik}) \subseteq U_{jk}$
	\end{itemize}
\end{definition}

For $i = j = k$, the cocycle condition implies that $\phi_{ii} = \id_{U_i}$ and for $i = k$, $\phi^{-1}_{ij} = \phi_{ji}$ and that $\phi_{ji}$ is an isomorphism $U_{ij} \cap U_{ik} \to U_{ji} \cap U_{jk}$

\note{(it looks like we can make the definition a bit stronger by imposing cocycle condition on those overlapped region where it makes sense, for example $\phi_{ji}(U_{ij} \cap U_{ik}) \cap U_{jk}$, but somehow the authors didn't do so, I don't understand now, will do later)}

\begin{proposition}
	Given a gluing of schemes, there exists a scheme $X$ together with morphism $\psi: U_i \to X$ such that
	\begin{itemize}
		\item for all $i \in I$, the map $\psi_i$ is an isomorphism from $U_i$ into an open subscheme of $X$
		\item $\psi_j \phi_{ji} = \psi_i$ on $U_{ij}$ for all $i, j \in I$
		\item $X = \bigcup_{i \in I} \psi_i(U_i)$
		\item $\psi_i (U_i) \cap \psi_j (U_j) = \psi_i (U_{ij}) = \psi_j (U_{ji})$ for all $i, j \in I$
	\end{itemize}
	
	Furthermore, $(X, \psi_i)$ is unique up to unique isomorphism.
\end{proposition}

\note{(there's a similar result in differential manifold using sheaf. it seems like sheaf is the categorical notion tool for gluing, just like morphism is the categorial notion of mapping, (co)limit is the categorical notion of sequential limit)}

Gluing of morphisms implies the universal property of gluing schemes

\begin{remark}[universal property of gluing schemes]
	If $T$ is a scheme and for every $i \in I$, there is a map $\xi_i: U_i \to T$ such that $\xi_j \phi_{ji} = \xi_i$ on $U_{ij}$ for all $i, j \in I$, then there exists a unique morphism $\xi: X \to T$ with $\xi \psi_i = \xi_i$ for every $i \in I$
\end{remark}

\note{(GW requires each $\xi_i$ is an isomorphism into its image but it's clearly not required)}

\subsection{SOME EXAMPLES OF GLUING SCHEMES}

\textbf{example:} (gluing two schemes) When the index set $I = \set{1, 2}$, any two open subsets $U_{12} \subseteq U_1$ and $U_{21} \subseteq U_2$ and an isomorphism $\phi: U_{12} \xrightarrow{\sim} U_{21}$ is a gluing of schemes. Let $X$ be the glued scheme, for any open subset $V \subseteq X$, we have
$$
	\Gamma(V, \ms{O}_X) = \set{(s1, s2) \in \Gamma(V \cap U_1, \ms{O}_{U_1}) \times \Gamma(V \cap U_2, \ms{O}_{U_2}): \phi^\flat(s_2\vert_{V \cap U_{21}}) = s_1 \vert_{V \cap U_{12}}}
$$

\note{(this is just a pushout/colimit in schemes and pullback/limit in rings)}

\textbf{example:} (affine line with double origin) Let $k$ be a field, let $U_1 = U_2 = \Spec k[x]$, let $U_{12} = U_{21} = \Spec k[x] - \set{(x)}$ and the gluing morphism $U_{12} \to U_{21}$ the identity map. The global section is $\Gamma(\ms{O}_X) = k[x]$ (\note{exercise 3.26 -> showing $X$ is not affine})

\textbf{example:} (projective space) Let $R$ be a ring. Define the projective space $\PP^n_R$ over $R$ by gluing $n+1$ copies of affine space $\Aff^n_R$, that is, $U_i = \Aff^n_R$ for $i=0, ..., n$. For convenience, let
$$
	A^i = R[Y_0, ..., \widehat{Y}_i, ..., Y_n]
$$

($\widehat{Y}_i$ means $Y_i$ is ommited) and we can view these rings as subring of $R[X_0, ..., X_N, X_0^{-1}, ..., X_N^{-1}]$ by the inclusion $Y_j \mapsto X_j X_i^{-1}$, then $U_i = \Spec A^i$. For each pair $i \neq j$, set $U_{ij}$ to be the principal open set $D(Y_j) = A^i[Y_j^{-1}]$, let the gluing map $\phi_{ji}: U_{ij} \to U_{ji}$ be induced by the equality $A^i_{Y_j} \to A^j_{Y_i}$ in $R[X_0, ..., X_N, X_0^{-1}, ..., X_N^{-1}]$ as follows:

\begin{center}
	\begin{tikzcd}
		{A^i[Y_j^{-1}] = R[Y_0, ..., \widehat{Y}_I, ..., Y_N, Y_j^{-1}]} \arrow[rdd] &                                             & {A^j[Y_i^{-1}] = R[Y_0, ..., \widehat{Y}_I, ..., Y_N, Y_i^{-1}]} \arrow[ldd] \\
		Y_j^{-1} \arrow[d, maps to]                                              &                                             & Y_i^{-1} \arrow[d, maps to]                                              \\
		X_j^{-1} X_i                                                             & {R[X_0, ..., X_N, X_0^{-1}, ..., X_N^{-1}]} & X_i^{-1} X_j                                                            
	\end{tikzcd}
\end{center}

This scheme is called projective space of relative dimension $n$ over $R$. We consider the open subscheme $U_i$ of $\PP^n_R$ and denoted them by $D_+(X_i)$. The canonical ring morphism $R \to \Gamma(\PP^n_R)$ is an ismorphism. Hence, projective space is not affine.

\section{BASIC PROPERTIES OF SCHEME AND MORPHISM OF SCHEMES}


\subsection{ON LOCAL PROPERTIES}

In commutative algebra, one often observes many properties called local property in which a property on ring $A$ propagate into its prime ideals and maximal ideals. Below is an example
\begin{remark}[being zero is a local property]
	Let $A$ be a ring, let $x \in A$, then the following are equivalent
	\begin{enumerate}
		\item $x = 0$ in $A$
		\item $x = 0$ in $A_\mf{p}$ for every prime ideal $\mf{p}$
		\item $x = 0$ in $A_\mf{m}$ for every maximal $\mf{m}$
	\end{enumerate}
\end{remark}

There is an equivalent notion of local property. Since GW did not discuss it, Vakil only briefly mentioned it, below is my attempt to properly define local property

A property $P$ on some collection of objects is a subset of the collection, if an object $X$ belong to the subset, we said $X$ has property $P$ or $X$ is $P$ or $P(X)$

\begin{definition}[stalk-local]
	Let $X$ be a scheme and let $P$ be a property on schemes. $P$ is called stalk-local if there exists a property $Q$ on stalks of schemes such that $P(X) \iff Q(\ms{O}_{X, x})$ for every $x \in X$
\end{definition}

stalk-local property on schemes are the equivalence of local property on rings.

\begin{definition}[affine-local]
	Let $X$ be a scheme and let $P$ be a property on schemes $P$ is called affine-local if
	\begin{enumerate}
		\item (locality) if $P(X)$, then $P(U)$ for every open affine subscheme $U \subseteq X$
		\item (gluability) if $\set{U_i}_{i \in I}$ is an open affine cover of $X$ and $P(U_i)$ for every $i \in I$, then $P(X)$
	\end{enumerate}
\end{definition}

\begin{definition}[open-local]
	Let $X$ be a scheme and let $P$ be a property on schemes $P$ is called open-local if
	\begin{enumerate}
		\item (locality) if $P(X)$, then $P(U)$ for every open subscheme $U \subseteq X$
		\item (gluability) if $\set{U_i}_{i \in I}$ is an open cover of $X$ and $P(U_i)$ for every $i \in I$, then $P(X)$
	\end{enumerate}
\end{definition}

Since the open affine sets generate the topology on $X$, it is easy to show that open-local and affine-local are equivalent. Moreover, stalk-local implies affine-local. Side note on sheaf: \note{(somehow I just randomly admire the beauty of sheaf)}
\begin{proposition}[sections are determined by germs]
	Let $\ms{F}$ be a sheaf on $X$ and $U \subseteq X$ be an open set, then the canonical map from sections to stalks is injective
	$$
	\ms{F}(U) \to \prod_{x \in U} \ms{F}_x
	$$
\end{proposition}

This property has two important implications:
\begin{enumerate}
	\item A sheaf $\ms{F}$ on $X$ is completely determined by its étale space $E = \coprod_{x \in X} \ms{F}_x$ \footnote{topologized by the weakest topology generated by all compatible germs $(s_x)_{x \in U}$ for some $s \in \ms{F}(U)$ for some open $U \subseteq X$}
	
	\item A section $s \in \ms{F}(U)$ is zero if and only if $s$ is zero on all stalks on $U$
\end{enumerate}

The second point is actually the local property of being zero on rings. Back to local property, when $X = \Spec A$, then being zero is stalk-local. \note{(I will mumble something that I am not an expert in, so this is likely wrong)}

Another subtle issue is these local definitions use higher order logic, hence it will sometimes be more confusing. For example, below we characterize reduced scheme by two assertions
\begin{enumerate}
	\item being a reduced scheme is an affine-local property
	\item an affine scheme is reduced if and only if it is a reduced ring
\end{enumerate}

The definition of reduced schemes is constructed recursively where the base case is affine scheme. This is not possible to define reduced scheme from open-local since its definition refer to itself.

Final thought, it seems like sheaf (or locality and gluability) is literally what is called "geometric" properties

\subsection{TOPOLOGICAL PROPERTIES}

\begin{definition}[connected, quasi-compact, irreducible]
	A scheme is called connected/quasi-compact/irreducible if the underlying topological space is connected/quasi-compact/irreducible.	
\end{definition}

All affine schemes are quasi-compact.

\begin{definition}[injective, surjective, bijective]
	A morphism of schemes $f: X \to Y$ is called injective/surjective/bijective if the underlying set function is injective/surjective/bijective.
\end{definition}

\begin{definition}[open, closed, homeomorphism]
	A morphism of schemes $f: X \to Y$ is called open/closed/homeomorphism if the underlying continuous map is open/closed/homeomorphism.
\end{definition}

\subsection{NOETHERIAN SCHEMES}

\begin{definition}[locally Noetherian, Noetherian]
	A scheme $X$ is called locally Noetherian if every open affine subscheme $U \subseteq X$ is a Noetherian ring. A quasi-compact locally Noetherian scheme is called Noetherian.
\end{definition}

Localization of Noetherian rings is Noetherian, hence a stalk of a locally Noetherian scheme is a Noetherian ring and every affine scheme of a Noetherian ring is Noetherian. However, being Noetherian scheme is not stalk-local, the converse statement is false.

Noetherian affine scheme is the equivalence to Noetherian ring in ring theory.

\begin{proposition}
	An affine scheme $X$ is Noetherian if and only if it is a Noetherian ring.
\end{proposition}

\begin{lemma}
	Let $A$ be a ring and $\Spec A = \bigcup_{i \in I} D(f_i)$ be a finite open cover of $\Spec A$ by principal open subsets \footnote{that is, the ideal generated by $f_i$ is the whole ring $A$}. Let $M$ be an $A$-module, then $M$ is finitely generated if and only if for all $i \in I$, the localization $M_{f_i}$ is a finitely generated $A_{f_i}$-module.
\end{lemma}

\begin{remark}[Noetherian topological space]
	A topological space $X$ is called Noetherian if one of the following conditions satisfies:
	\begin{enumerate}
		\item Every nonempty collection of open sets has a maximal element
		\item Decending chain condition for closed sets.
	\end{enumerate}
	
	A finite covering $X = \bigcup_{i \in I} X_i$ of Noetherian spaces is Notherian.
\end{remark}

Hence, the topological space of an Noetherian scheme is Noetherian but the converse statement is false.

\begin{remark}[subsets of Noetherian topological space]
	Let $X$ be a Noetherian topological space
	\begin{enumerate}
		\item Every subspace of $X$ is Noetherian
		\item Every open subset of $X$ is quasi-compact
		\item Every closed subset of $X$ has only finitely many irreducible components.
	\end{enumerate}
\end{remark}

\begin{proposition}
	Let $X$ be a (locally) Noetherian scheme, then every open subscheme $U \subseteq X$ is (locally) Noetherian.
\end{proposition}

\subsection{GENERIC POINTS}

\begin{remark}
	Let $X$ be a topological space, a subspace $Z \subseteq X$ is irreducible if and only if its closure is irreducbile
\end{remark}

\begin{remark}
	Let $X$ be a topological space and $Z \subseteq X$, a point $z \in Z$ is called a generic point of $Z$ if $\overline{\set{z}} = Z$. 
\end{remark}

As closure of an irreducible subset is irreducible, if a subset of $X$ contains a generic point, it is irreducible. Moreover

\begin{proposition}
	Let  $X$ be a scheme, there is a bijection map
	\begin{align*}
		X &\to \set{\text{closed irreducible subsets of $X$}} \\
		x &\mapsto \overline{\set{x}}
	\end{align*}
\end{proposition}

\begin{proposition}
	Let $f: X \to Y$ be an open morphism of schemes and $Y$ be irreducible with generic point $\eta$. Then $X$ is irreducible if and only if the fiber $f^{-1}(\eta)$ is irreducible.
\end{proposition}

\begin{proof}
	\note{(the proof in GW was too short, skipped many point-set topology things, this is a better version)}
	
	It's clear that $\overline{f^{-1}(\eta)} \subseteq f^{-1}(\overline{\set{\eta}})$ since $f$ is continuous. Moreover, since $f$ is open, any open set $U \subseteq X$ is mapped into an open set $f(U) \subseteq Y$. $\set{\eta}$ is dense in $Y$, hence $\eta \in f(U)$, so $U \cap f^{-1}(\eta) \neq \emptyset$. $f^{-1}(\eta)$ cuts all open sets in $X$, so it is dense in $X$.
\end{proof}

Although schemes are never Hausdorff, they at least satisfy some weaker separation property.

\begin{proposition}
	Let $X$ be a scheme, then the underlying topological space $X$ is Kolmogorov ($T_0$-space), that is, for any two distinct point $x, y \in X$, there exists an open subset of $X$ containing exactly one of the points.
\end{proposition}

\subsection{REDUCED SCHEME, INTEGRAL SCHEME}

A reduced ring is a ring with no nilpotent

\begin{definition}[reduced scheme]
	A scheme is called reduced if every stalk is reduced.
\end{definition}

\note{(from here, we diverted from GW a bit so that it is easier to internalize)}

By definition, being reduced is a stalk-local property, hence also an affine-local and open-local. Since being reduced ring is a local property, there for an affine scheme is reduced if and only if it is a reduced ring. One can characterized reduced scheme as follows:

\begin{remark}
	A reduced scheme is characterized by the following two conditions:
	\begin{enumerate}
		\item being reduced scheme is an affine-local property
		\item an affine scheme is reduced if and only if it is a reduced ring.
	\end{enumerate}
\end{remark}

Moreover, a reduced scheme is also decided by its global sections of open subschemes

\begin{proposition}
	A scheme is reduced if and only if the global sections of every open subscheme is a reduced ring.
\end{proposition}

\begin{proof}
	The converse is easy since every open affine subscheme is an open subscheme. We will show the implication. Since sections are determined by germs, let $U \subseteq X$ be an open subscheme of a reduced scheme $X$, let $f \in \Gamma(U, \ms{O}_X)$, then $f = 0$ if and only if $f_x = 0$ in every stalk $\ms{O}_{X, x}$ with $x \in U$. Since every stalk is reduced, $f^n = 0$ implies $f_x^n = 0$ for every $x \in U$ implies $f_x = 0$ for every $x \in U$ implies $f = 0$. Hence, $\Gamma(U, \ms{O}_X)$ is reduced.
\end{proof}

Integral affine scheme is the equivalence to integral domain in ring theory.

\begin{definition}[integral scheme]
	A scheme is called integral if it is reduced and irreducible.
\end{definition}

\begin{proposition}
	An affine scheme is integral if and only if it is an integral domain.
\end{proposition}

\begin{longproof}
	($\impliedby$)	When ring $A$ is an integral domain, $\eta = (0)$ is a prime, hence $\overline{\set{\eta}} = V(\eta) = \Spec A$. Therefore, $\Spec A$ is irreducible. $\Spec A$ is reduced because every integral domain is reduced.
	
	($\implies$) When $X = \Spec A$ is integral, let $a, b \in A$ so that $ab = 0$, note that $D(a) \cap D(b) = D(ab) = 0$. Since $X$ is irreducible, either $D(a)$ or $D(b)$ is empty. Suppose $D(a)$ is empty, then $a$ belongs to every prime ideal. In other words, $a$ belongs to the nilradical of $A$. On the other hand, $X$ being reduced implies $A$ being reduced, the nilradical of $A$ is $\set{0}$. Hence $a = 0$.
\end{longproof}

In an affine scheme, there is a one-to-one correspondence between open subschemes and localizations. Since open subscheme of an irreducible scheme is irreducible and being reduced scheme is an open-local property, every open subscheme of an integral affine scheme is also integral. We arrived at the first algebraic fact derived from geometry.

\begin{remark}
	Every localization of an integral domain is an integral domain
\end{remark}

Moreover, every stalk of an integral affine scheme is an integral domain. Scheme is covered by affine schemes, being reduced is open-local and open subscheme is irreducible, hence each affine scheme is integral. Hence, every stalk of an integral scheme is an integral domain. However, the converse is not true.

\begin{proposition}
	Every stalk of an integral scheme is an integral domain.
\end{proposition}

Similar to reduced scheme, an integral scheme is also decided by its global sections of open subschemes

\begin{proposition}
	A scheme is integral if and only if the global sections of every open subscheme is an integral domain.
\end{proposition}

\begin{longproof}
	($\impliedby$) It suffices to show that if $\Gamma(U, \ms{O}_X)$ is an integral domain for every open subscheme $U \subseteq X$, then $X$ is irreducible. \note{(here, we just follow GW's book)} Suppose $X$ is not irreducible, that is $X = U \cup V$ for some nonempty open subschemes $U, V$. Then
	$$
		\Gamma(X, \ms{O}_X) = \Gamma(U \cup V, \ms{O}_X) = \Gamma(U, \ms{O}_X) \times \Gamma(V, \ms{O}_X)
	$$
	
	The right hand side product contains zero divisors: $(1, 0) \cdot (0, 1) = (0, 0)$
	
	($\implies$) It suffices to show that $\Gamma(X, \ms{O}_X)$ is an integral domain since every localization of an integral domain is an integral domain.
	
	\note{(TODO - not sure why in GW's book, the proof is similar to my proof in affine case, they talked about $V(f) \subseteq \Spec A$ for some $f \in A = \Gamma(X, \ms{O}_X)$) then invoke the irreducibilty of $X$ for $V(f)$, clearly $X$ differs from $\Spec A$}
\end{longproof}

\subsubsection{FUNCTION FIELD OF AN INTEGRAL SCHEME}

Around the generic point of an integral scheme, pick an open affine scheme. The affine scheme corresponds to an integral domain and the generic point corresponds to the zero ideal, hence its stalk is a field.

\begin{definition}[function field]
	Let $X$ be an integral scheme and $\eta \in X$ be its generic point. Then the stalk $\ms{O}_{X, \eta}$ is a field which is called the function field of $X$ and denoted by $K(X)$
\end{definition}

For an integral scheme, every ring of functions is contained in the function field which is formalized as follows:

\begin{proposition}
	Let $X$ be an integral scheme with generic point $\eta$ and let $K(X)$ be its function field
	\begin{enumerate}
		\item if $\Spec A \subseteq X$ is a non-empty open affine subscheme, then $\Frac(A) = K(X)$. if $x \in X$, then $K(X) = \Frac(\ms{O}_{X, x})$
		
		\item let $U \subseteq V \subseteq X$ be non-empty open subschemes, the maps \footnote{since $\eta$ is dense, $\eta$ is contained in any open subset} below are injective
		$$
			\Gamma(V, \ms{O}_X) \xrightarrow{\res} \Gamma(U, \ms{O}_X)\to \ms{O}_{X, \eta} = K(X)
		$$

		\item for every non-empty open subset $U \subseteq X$ and every open cover $\set{U_i}$ of $U$, then
		$$
			\Gamma(U, \ms{O}_X) = \bigcap_i \Gamma(U_i, \ms{O}_X) = \bigcap_{x \in U} \ms{O}_{X, x}
		$$
		
		where the intersections take place in $K(X)$ by the injective maps $\Gamma(U_i, \ms{O}_X) \to \ms{O}_{X, \eta} = K(X)$ and $\ms{O}_{X, x} \to \Frac(\ms{O}_{X, x}) = K(X)$
	\end{enumerate}
\end{proposition}

\section{PREVARIETIES AS SCHEMES}

\note{I skipped this part as prevariety seems like a uglier version of scheme, and this part feels like a historical note rather than something interesting}

\section{SUBMERSION AND IMMERSION}

\subsection{OPEN IMMERSION}

\begin{definition}[open immersion]
	A morphism $j: Y \to X$ of schemes is called an open immersion if
	\begin{enumerate}
		\item the underlying continuous map is a homeomorphism from $Y$ into an open subset $U \subseteq X$
		\item the morphism of sheaves $\ms{O}_X \to j_* \ms{O}_Y$ induces an isomorphism $\ms{O}_X\vert_U \xrightarrow{\sim} j_* \ms{O}_Y$
	\end{enumerate}
\end{definition}

\subsection{CLOSED SUBSCHEME}

\begin{remark}[sheaf of ideals, quotient sheaf]
	Given a ringed space $(X, \ms{O}_X)$, we said the subsheaf $\ms{J} \subseteq \ms{O}_X$ a sheaf of ideals if for every open subset $U \subseteq X$, the sections $\Gamma(U, \ms{J})$ is an ideal in $\Gamma(U, \ms{O}_X)$. The quotient sheaf which is a sheaf of rings, denoted by $\ms{O}_X / \ms{J}$, is defined as the sheaf associated to the presheaf
	$$
		U \mapsto \ms{O}_X(U) / \ms{J}(U)
	$$
	
	The canonical projection $\ms{O}_X \to \ms{O}_X / \ms{J}$ is an epimorphism.
\end{remark}

\begin{definition}
	Let $X$ be a scheme
	\begin{enumerate}
		\item A closed subscheme $Z$ of $X$ is a scheme such that $Z$ is a closed subset of $X$, $i: Z \to X$ is the inclusion, and the sheaf $i_* \ms{O}_Z$ on $X$ is isomorphic to a quotient sheaf $\ms{O}_X / \ms{J}$
		
		\item A morphism of schemes $i: Z \to X$  is called a closed immersion if 
		\begin{enumerate}
			\item the underlying continuous map is a hemeomorphism from $Z$ into a closed subset of $X$
			\item the morphism of sheaves $i^\flat: \ms{O}_X \to i_* \ms{O}_Z$ is an epimorphism.
		\end{enumerate}
		
		\item If $Z \subseteq X$ is a closed subscheme, then there is a closed immersion $(i, i^\flat): Z \to X$. On the other hand, if $i: Z \to X$ is a closed immersion, then $Z$ is ismorphic to some closed subscheme of $X$.
	\end{enumerate}
\end{definition}

\note{(this is important)} In part (1) GW specifically requires $Z$ to be a scheme since this is not true for arbitrary $\ms{J}$. \note{(sheaf of ideals defines a closed subscheme if and only if it is a quasi-coherent sheaf)}

In an affine scheme, every closed subscheme is identified by an ideal. More formally,

\begin{theorem}
	Let $X = \Spec A$ be an affine scheme, there is a bijection between the set of ideals of $A$ and the set of closed subschemes of $X$ given by
	$$
	\mf{a} \mapsto V(\mf{a}) \cong \Spec A / \mf{a}
	$$
	In particular, every closed subscheme of an affine scheme is affine.
\end{theorem}

\note{(GW didn't give any example, below is my take)}

\textbf{example:} (affine scheme) Let $A$ be a ring and $\mf{a}\subseteq A$ be an ideal. Let $X = \Spec A$ and $\ms{J} \subseteq \ms{O}_X$ be the sheaf of ideals defined as follows: for every $f \in A$,
$$
	\ms{J}(D(f)) = \mf{a}_f \subseteq A_f
$$

where $\mf{a}_f$ is the image of $\mf{a}$ under the canonical map $A \to A_f$. Let $\ms{Q} = \ms{O}_X / \ms{J}$ be the quotient sheaf, that is
$$
	\ms{Q}(D(f)) = A_f / \mf{a}_f = (A / \mf{a})_f
$$

This is a quasi-coherent sheaf. For every $x \in X$ with associated prime ideal $\mf{p} \subseteq A$, the stalk of $\ms{Q}$ at $x$ is
$$
	\ms{Q}_x = \colim_{f \notin \mf{p}} A_f / \mf{a}_f  = \colim_{f \notin \mf{p}} (A / \mf{a})_f
$$

If $\mf{p}$ is a prime in $A / \mf{a}$, in other words, $x \in V(\mf{a})$, then $\ms{Q}_x = (A / \mf{a})_\mf{p}$. Otherwise, there exists $a \in \mf{a}$ but $a \notin \mf{p}$, then $(A / \mf{a})_a = 0$ is in the colimit diagram of $\ms{Q}_x$, that is, there is a ring map $(A / \mf{a})_a = 0 \to \ms{Q}_x$. Hence, $\ms{Q}_x = 0$.

$$
	\ms{Q}_x = \begin{cases}
		(A / \mf{a})_\mf{p} &\text{if $x \in V(\mf{a})$} \\
		0 &\text{otherwise}
	\end{cases}
$$

The zero ring is not a local ring, hence $(X, \ms{Q})$ is not a scheme or any restriction to any closed set not inside $V(\mf{a})$. From the theorem above, $(V(\mf{a}), \ms{Q})$ is the canonical closed subscheme of the affine scheme $X$. \note{(talk about closed subset of $V(\mf{a})$ being a scheme, not sure)}

\subsection{SUBSCHEME AND IMMERSION}

Open and closed subschemes are special cases of locally closed subscheme
\begin{definition}
	
\end{definition}



















